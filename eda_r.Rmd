---
title: "EDA con R"
output: github_document
editor_options: 
  chunk_output_type: console
---


## Preliminares

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(magrittr)
library(skimr)
<<<<<<< HEAD
library(dplyr)

=======
library(janitor)
library(rstatix)
library(fdth)
library(corrplot)
library(ggplot2)
>>>>>>> ae3444ee58a76e022e3b38411b4b87e78decd0dd
```

### Importacion

```{r}
data <- read_csv('Data/Churn_Modelling.csv')
```
#### Verificar y corregir columnas

```{r}
data %>% glimpse
```

```{r}
data %>% 
  mutate(
    HasCrCard= factor(HasCrCard, levels= c(0, 1), 
                             labels= c('no', 'si') ),
    IsActiveMember= factor(IsActiveMember, levels= c(0, 1), 
                             labels= c('no', 'si') ),
    Exited= factor(Exited, levels=c(0,1), labels= c('no','si'))
    
  ) ->
  data
```

```{r}
data %>% glimpse
```


# EDA

## EDA Univariado


### Todas las variables
```{r}
skim( data)
```



### Variables con posibles outliers

```{r}
data %>% 
  reframe( 
    tibble(
      Descrip= c('P_0', 'P_02', 'P_25', 'P_50' , 'P_75', 'P_98', 'P_100') ,
      Valor= quantile( Balance, c(0, 0.2, 0.25, 0.50 ,0.75, 0.98, 1), na.rm= T)
    )
    )
```

```{r}
data %>% 
  ggplot( aes(x=1, y= Balance)) +
  geom_boxplot() + 
  coord_flip() +
  theme_bw()
```

```{r}
data %>% 
  reframe( 
    tibble(
      Descrip= c('P_0', 'P_02', 'P_25', 'P_50' , 'P_75', 'P_97', 'P_100') ,
      Valor= quantile( CreditScore, c(0, 0.2, 0.25, 0.50 ,0.75, 0.97, 1), na.rm= T)
    )
    )
```

### Balanceo


```{r}
data %>% 
  group_by(Exited) %>% 
  count()
```

```{r}
data %>% 
  group_by(Exited) %>% 
  count() %>% 
  ggplot( aes(x= Exited, y= n)) +
  geom_col()
```


## EDA Multivariado

### Room 11

#### CreditScore vs Exited

**Tabla**
```{r}

```

**Grafico**
```{r}

```

**Interpretacion**





### Room 14

#### Balance vs Exited

**Tabla**
Descriptivos
```{r warning=FALSE}
library(doBy)
library(DescTools)

data_r14 <- data %>% 
  mutate(
    Exited= factor(Exited, levels= c(0, 1),labels=c("no","si")))
  
cuartil_25 <- function(x) {
  q25 <- quantile(x, 0.25, na.rm = TRUE)
  return(cuartil = q25)
}

cuartil_75 <- function(x) {
  q75 <- quantile(x, 0.75, na.rm = TRUE)
  return(cuartil = q75)
}

summaryBy(
  Balance ~ Exited,
  data = data_r14,
  FUN = c(mean, Mode, cuartil_25, median, cuartil_75, sd, min, max)
)

```

```{r}
#Cambiar variable Exited a factor

data %>% 
  mutate(
    Exited = factor(Exited, levels= c(0, 1), 
                             labels= c('no', 'si') ),
  ) ->
  data
```

Correlaci√≥n de Spearman
```{r warning=FALSE}
cor(data_r14$Balance,as.numeric(data_r14$Exited))
```
Correlaci√≥n Point-Biseral
```{r warning=FALSE}
library(polycor)
polyserial(data_r14$Balance,data_r14$Exited)
```

<<<<<<< HEAD
```{r}
#Naturaleza de los datos
data %>% glimpse

```

#### Geography vs Exited

**Tabla**

```{r}
# Crear tabla de frecuencia
freq_table <- table(data$Exited, data$Geography)
print(freq_table)
```


```{r}
# Convertir la tabla en un formato de datos adecuado para barplot
bar_data <- as.data.frame.matrix(freq_table)
```

**Gr·fico**

```{r}
barplot(freq_table,
        xlab = "PaÌs", ylab = "Frecuencia",
        col = c("#53868B", "#76EEC6"),
        ylim=c(0,6000),
        xlim=c(0,6), 
        legend.text = rownames(freq_table))

```
**IntepretaciÛn**

Estos resultados sugieren que la proporciÛn de clientes que abandonan el banco varÌa seg˙n el paÌs de residencia. 

En Francia, la mayorÌa de los clientes, representados por 4204 observaciones, optaron por no abandonar el banco, mientras que 810 clientes sÌ tomaron esa decisiÛn. En Alemania, la distribuciÛn es m·s equitativa, con 1695 clientes que decidieron quedarse y 814 que abandonaron. Por ˙ltimo, en EspaÒa, aunque 2064 clientes eligieron permanecer, 413 clientes tomaron la decisiÛn de abandonar el banco.


#### EstimatedSalary vs Exited

**EstadÌsticas descriptivas**

```{r}
library(doBy)

summary_data <- summaryBy(EstimatedSalary ~ Exited, data = data, FUN = c(mean, sd, median)) #Media, desviaciÛn est·ndar y mediana
```

**IntepretaciÛn**

Media: Para aquellos clientes que no abandonaron el banco, la media del salario es de aproximadamente $99,738.39.Para aquellos clientes que abandonaron el banco, la media del salario es de aproximadamente $101,465.68.

DesviaciÛn est·ndar: Para aquellos que no abandonaron el banc, la desviaciÛn est·ndar del salario es de aproximadamente $57,405.59. Para aquellos que abandonaron el banco, la desviaciÛn est·ndar del salario es de aproximadamente $57,912.42.La comparaciÛn de las desviaciones est·ndar sugiere que la variabilidad en los salarios no difiere significativamente entre aquellos que abandonaron y los que no abandonaron el banco. 

Mediana:Para aquellos que no abandonaron el banco, la mediana del salario es de aproximadamente $99,645.04.
Para aquellos que abandonaron el banco, la mediana del salario es de aproximadamente $102,460.84. 

Dado que los valores de la media y la mediana son bastante similares, esto indica que la mayorÌa de los datos est·n distribuidos de manera uniforme alrededor del centro de la distribuciÛn, y no se observan valores extremadamente altos (outliers).


**Grafico de densidad**

```{r}
ggplot(data, aes(x = EstimatedSalary, fill = Exited)) +
  geom_density(alpha = 0.5) +
  labs(title = "Gr·fico de Densidad",
       x = "Salario", y = "Densidad") +
  theme_minimal()
```


**Diagrama de caja**


```{r}
library(ggplot2)

ggplot(data, aes(x = Exited, y = EstimatedSalary)) +
  geom_boxplot(fill = "skyblue", color = "black") +
  labs(title = "Boxplot",
       x = "Abandono", y = "Salario")
```

**InterpretaciÛn**
A partir de lo anterior, se puede mencionar que el salario tiene poco efecto sobre las posibilidades de que un cliente abadone el banco. 

Nota: no hay una diferencia visual aparente en la distribuciÛn de la variable salario entre los clientes que abandonaron y los que no abandonaron el banco. Por ende, la variable salario puede no ser ˙til para el an·lisis.
=======
**Grafico**
Densidad
```{r}
library(ggplot2)
data_r14 %>% 
  ggplot(aes(x=Balance, fill=Exited))+
  geom_density()+
  theme_bw()+
  facet_grid(. ~ Exited)
```
Densidad
```{r}
library(ggplot2)
data_r14 %>% 
  ggplot(aes(x=Balance, fill=Exited))+
  geom_boxplot()+
  theme_bw()+
  facet_grid(. ~ Exited)
```

**Interpretacion**
Balance:
Se puede observar que los clientes que abandonan la entidad tienen una media superior a los que no abandonan. Esto representar√≠a lo obvio en una situaci√≥n normal. Sin embargom se puede ver que existe bastante cantidad de gente que abandona la instituci√≥n con una poca cantidad de dinero. Esto se podr√≠a explicar por normas o reglamentos que se hayan aajustado y pudo haber causado incertidumbre en los clientes. Tambi√©n se debe notar que la mayor√≠a de gente que no abandona la entidad tiene poco dinero. Sin embargo, el promedio de estos no est√° alejado de los que s√≠ abandonan.

#### CreditScore vs HasCrCard vs Exited
```{r}
ggplot(data_r14, aes(x = CreditScore, fill = HasCrCard)) +
  geom_density(alpha = 0.5) +
  labs(title = "Gr√°fico de Densidad Agrupado por 'Exited' ",
       x = "Credit Score",
       y = "Densidad") +
  theme_minimal() +
  facet_grid(Exited ~ .)
```
Si bien se ve que la distribuci√≥n de los clientes que abandonaron y los que no se asemejan mucho. Los que abandonaron tienen cierta tendencia a tener un poco peor score que los que no. Principalmente si no tienen tarjeta de cr√©dito. Esto indicar√≠a que el problema se puede dar en alg√∫n otro producto financiero de la entidad y no precisamente de las tarjetas de cr√©dito. 
>>>>>>> ae3444ee58a76e022e3b38411b4b87e78decd0dd

### Room 15






### Room 16
```{r}
data %>% ggplot(aes(x=NumOfProducts,y=Balance)) + 
  geom_point()
```


```{r}
data %>% ggplot(aes(x=NumOfProducts,y=Balance)) + 
  geom_point()

```


```{r}
data %>% ggplot(aes(x=Exited,y=Age)) + geom_boxplot()
```

```{r}
# realizar una prueba Anova

# Variables cualitativas
data %>%
  tabyl (HasCrCard,Exited) %>% 
  adorn_totals(c("row"))%>% adorn_percentages("col") %>% 
  adorn_pct_formatting(digits = 2)

```


```{r}
#3 variables
data %>% ggplot(aes(x=HasCrCard,y=Age, color=Exited)) + 
  geom_boxplot()

```



